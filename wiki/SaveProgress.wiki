#summary Progress of saving a SAVE Flash file
#labels Featured

= Introduction =

This page will show the progress made for saving altered save files.

= Progress =

  * Memory Map, Journal & Blockmap are in the context.
  * CRC16 of the blockmap is possible through CRC16.cs.

----

== Unknown Hashes ==

*Image Hash:* (0x10 @ 0x0000)

  + Changes from one save to another.
  
  - Algorithm is unknown.

*Partition Hash:* (0x20 @ 0x010C into Parition entry)

  + Changes from one save to another.

  ? Algorithm - Probably SHA256 becuase it's 32 Bytes.

  - Isn't understood. (didn't find with brute force)

*Partition Hash Table Header:* (0x40 @ 0x0000 into the partition)

  + Changes from one save to another.

  - Algorithm is unknown.

----
= Algorithm Proposal =

== Required stuff: ==

  * Image binary (byte array)
  * Key Binary (byte array - 512 bytes)
  * Blockmap + Journal + Memory Map
  * Disa & Partition table

After changing a file in the partition.
  # (Done) Go over the partitions and rehash the hashtable entries (that aren't 0)
  # (Unknwon) Make the 'Partition Hash Table Header'
  # (Unknown) Go over the Partition table and and make the proper hash (for SAVE & DATA).
  # (Done) Hash the active partition table into the DISA struct.
  # (Done) Rearrange the 0x1000 blocks according to the Memory Map.
  # (Done) Chechsum every 0x1000 block according to 3DBrew.
  # (Done) CRC16 (Modbus) the blockmap
  # (Done) XOR the whole thing from 0x1000 with the key-file.